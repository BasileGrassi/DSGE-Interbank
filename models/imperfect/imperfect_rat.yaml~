name: DSGE Interbank Grassi 2012
#with inelastic labor and log utility
#Warning the definition of mm=M/P(-1) so the real money balance is m = mm/(1+PI)

#k is capital used by an individual firm, capital actually used for production is Phi*k
#mL is the real money balance disponible at the begining of the period

declarations:

    states: [k, mm, mL, z, u]

    controls: [lamb, R, PI, RL, nu_def]

    auxiliary:  [Phi, mu, w, y, pro, rk, x, Enu_def, d, lhat, nu_rat, nu_strat, m, c, uc, I]

    shocks: [e_z,e_u]

    parameters: [beta, alpha, delta, x_ss, theta, gamma, varphi, rho, sigma_z, sigma_u, me, sigma,vartheta]

equations:

    transition: 
        - k = (1-delta)*Phi(-1)*k(-1)+y(-1)-c(-1) 
        - mm = (1+x_ss+gamma*u(-1)+varphi*z(-1)+e_u)/(1+PI(-1))*mm(-1)
        - mL = mm(-1)/(1+PI(-1))
        - z = rho*z(-1)+e_z
        - u = gamma*u(-1)+varphi*z(-1)+e_u


    auxiliary:
#first part
        - Phi = 1-exp(-(nu_def-me)/sigma)
        - mu = Phi^(1/(theta-1))*(theta-1)/theta
        - w = mu*(1-alpha)*exp(z)*k^alpha
        - y = exp(z)*Phi^(theta/(theta-1)+alpha-1)*k^alpha
        - pro= 1/(theta-1)*(theta/(theta-1))^(-theta)*(mu)^(1-theta)*y
        - rk=mu*alpha*exp(z)*k^(alpha-1)
#second part
        - x = u+x_ss
        - Enu_def = (me+sigma-(nu_def+sigma)*exp(-(nu_def-me)/sigma))/Phi
        - d=(Enu_def*w/exp(z)*Phi-(1-Phi)*(k+x)/RL)/(Phi-(1-Phi)*(R-1)/RL)
        - lhat= (k+x-(R-1)*d)/RL
        - nu_rat=(d+x+lhat)/(w/exp(z))
        - nu_strat=(pro+(RL-R)*d+RL*x-vartheta*lhat)/(RL*(w/exp(z)))
#third part
        - m = mm/(1+PI)
        - c = mL/(1+PI)-d
        - uc = 1/c
        - I = y - c


    arbitrage:
        - lamb = beta*(1+rk(1)-delta)*Phi(1)*lamb(1)                                | -inf <= lamb <= inf
        - lamb = beta*lamb(1)*R(1)/(1+PI(1))                                        | -inf <= R <= inf
        - uc = beta*R*uc(1)/(1+PI(1))                                               | -inf <= PI <= inf
        - (RL-R)*Phi = (1-Phi)*(R-1)/RL                                                                    | -inf <= RL <= inf
        - nu_def=nu_rat                                                             | -inf <= nu_def <= inf


calibration:

    parameters:
        beta: 0.989
        alpha: 0.36
        delta: 0.019
        x_ss: 0.0125
        theta: 6
        gamma: 0.5
        varphi: 0
        rho: 0.95
        sigma_z: 0.007
        sigma_u: 0.0089
        me:  -5.6879
        sigma: -1
        vartheta: 0.8

    steady_state:
        z: 0
        u: 0
        PI: x_ss
        x: x_ss
        R: (1+PI)/beta
        RL: 1.0241
        nu_def:  -8.8332
        k: 17.3768
        d: -17.7550
#Solvable for a given nu_def and a given k
        lhat: (k+x-(R-1)*d)/RL
        nu_rat: (d+x+lhat)/(w/exp(z))
        nu_strat: (pro+(RL-R)*d+RL*x-vartheta*lhat)/(RL*(w/exp(z)))
        Phi: 1-exp(-(nu_def-me)/sigma)
        rk: mu*alpha*exp(z)*k^(alpha-1) #delta+1/(beta*Phi)-1
        mu: Phi^(1/(theta-1))*(theta-1)/theta
        y: Phi^(theta/(theta-1)+alpha-1)*k^alpha
        w: mu*(1-alpha)*exp(z)*k^alpha
        pro: 1/(theta-1)*(theta/(theta-1))^(-theta)*(mu)^(1-theta)*y
        I: k*(1-(1-delta)*Phi)
        c: y-I
        Enu_def: (me+sigma-(nu_def+sigma)*exp(-(nu_def-me)/sigma))/Phi
        mL: (1+PI)*(c+d)
        m: mL
        mm: (1+PI)*m
        uc: 1/c
        lamb: uc/R



    covariances: |
        [[ sigma_z**2, 0],
         [0, sigma_u**2]],
        
        
